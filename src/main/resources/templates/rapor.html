<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Kete Ekmek</title>
    <link rel="icon" th:href="@{/icon/favicon.ico}" type="image/x-icon">
    <link th:rel="stylesheet" th:href="@{/css/firin.css}" type="text/css"/>
    <link th:rel="stylesheet" th:href="@{/css/bootstrap.min.css}" type="text/css"/>
    <link th:rel="stylesheet" th:href="@{https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css}" type="text/css"/>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300&display=swap" rel="stylesheet">
</head>
<body>

<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-dark static-top navbar-custom-background">
    <div class="container">
        <div class="col-md-10 mx-auto mt-2">
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item">
                        <a class="navbar-brand nav-link" href="/"><i class="fa-solid fa-house"></i></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/cari">Cari Hesap <i class="fa-solid fa-user-tie"></i></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/urun">Ürünler <i class="fa-solid fa-cookie-bite"></i></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/siparis">Sipariş <i class="fa-solid fa-receipt"></i></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/tahsilat">Tahsilat <i class="fa-solid fa-cash-register"></i></a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="/rapor">Rapor <i class="fa-solid fa-table"></i></a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</nav>

<div class="container">
    <div class="row">
        <div class="alert alert-success" role="alert" th:text="${success}" th:if="${success}"></div>
        <div class="alert alert-danger" role="alert" th:text="${error}" th:if="${error}"></div>
    </div>

    <div class="row">
        <div class="col-md-10 mx-auto mt-2">
            <div class="row mt-auto"><span class="ust_baslik txt-deep-purple">Rapor</span></div>
            <div class="row mt-0 p-0 border-koseli-2px">
                <form method="post" th:action="@{/rapor}" id="tahsilatForm" name="tahsilatForm" class="col card p-2 m-2 borderless">

                    <div class="input-group mb-2">
                        <label class="input-group-text but-deep-purple border-koseli-1px width150px">Rapor Tipi</label>
                        <select th:name="tip" th:id="tip" class="form-control form-select border-koseli-1px">
                            <option th:selected="${tip eq 'T'}" value="T">Tahsilat</option>
                            <option th:selected="${tip eq 'S'}" value="S">Sipariş</option>
                        </select>
                    </div>

                    <div class="input-group mb-2">
                        <span class="input-group-text but-deep-purple border-koseli-1px width150px">Cari</span>
                        <select th:name="cariId" th:id="cariId" class="form-control form-select border-koseli-1px">
                            <option th:value="${'0'}" th:text="${'-- TÜM MÜŞTERİLER --'}" th:selected="${cariId eq 0}"></option>
                            <option th:each="cari : ${cariList}"
                                    th:value="${cari.getId()}"
                                    th:text="${cari.getCariAd() + ' - ' + cari.getCariYetkili()}"
                                    th:selected="${cari.getId() == cariId}"></option>
                        </select>
                    </div>

                    <div class="input-group mb-2">
                        <span class="input-group-text but-deep-purple border-koseli-1px width150px">Başlangıç<span class="pe-2"></span><i class="fa-solid fa-calendar-days"></i></span>
                        <div class="input-group-text p-0 border-koseli-1px date">
                            <input type="date" th:value="${dateUtils.toIsoDate(baslangicTarihi)}" class="form-control border-0" required th:name="baslangicTarihi" th:id="baslangicTarihi">
                        </div>
                        <input th:id="page" th:name="page" type="hidden" th:value="${pageNo ne null} ? ${pageNo} : 0"/>
                    </div>

                    <div class="input-group mb-2">
                        <span class="input-group-text but-deep-purple border-koseli-1px width150px">Bitiş<span class="pe-2"></span><i class="fa-solid fa-calendar-days"></i></span>
                        <div class="input-group-text p-0 border-koseli-1px date">
                            <input type="date" th:value="${dateUtils.toIsoDate(bitisTarihi)}" class="form-control border-0" required th:name="bitisTarihi" th:id="bitisTarihi">
                        </div>
                    </div>

                    <div class="border-0 d-flex justify-content-start">
                        <div class="border-0 me-2">
                            <button class="btn btn-sm but-indigo" type="submit" id="raporKaydet">Listele <i class="fa-solid fa-table-list"></i></button>
                        </div>
                    </div>
                </form>

                <table class="table table-striped border-top-2px p-0 m-0">
                    <th:block th:if="${tip eq 'T'}">
                        <tr class="but-purple">
                            <th class="text-white-50">ID</th>
                            <th class="text-white-50">Kimden</th>
                            <th class="text-white-50">Tutar</th>
                            <th class="text-white-50">Tahsilat Tarih</th>
                            <th class="text-white-50">İşlem Tarihi</th>
                        </tr>
                        <tr th:if="${tahsilatList.isEmpty()}">
                            <td colspan="10">Henüz Kayıt Yok...</td>
                        </tr>
                        <tr th:id="'tr_' + ${tahsilat.getId()}" th:each="tahsilat : ${tahsilatList}">
                            <td th:text="${tahsilat.getId()}"></td>
                            <td th:text="${cariMap.get(tahsilat.getCariId()).getCariAd()} +' - ' + ${cariMap.get(tahsilat.getCariId()).getCariYetkili()}"></td>
                            <td th:text="${tahsilat.getTutar()} + ' TL'"></td>
                            <td th:text="${dateUtils.toTurkishDateFromIso(tahsilat.getTarihOdeme())}"></td>
                            <td th:text="${dateUtils.toTurkishDateTime(tahsilat.getTarih())}"></td>
                        </tr>
                    </th:block>

                    <th:block th:if="${tip eq 'S'}">
                        <tr class="but-purple">
                            <th class="text-white-50">ID</th>
                            <th class="text-white-50">Kime</th>
                            <th class="text-white-50">Ürün</th>
                            <th class="text-white-50">Adet</th>
                            <th class="text-white-50">Tutar</th>
                            <th class="text-white-50">S - İ</th>
                            <th class="text-white-50">İşlem Tarihi</th>
                        </tr>
                        <tr th:if="${siparisList.isEmpty()}">
                            <td colspan="10">Henüz Kayıt Yok...</td>
                        </tr>
                        <tr th:id="'tr_' + ${siparis.getId()}" th:each="siparis : ${siparisList}">
                            <td th:text="${siparis.getId()}"></td>
                            <td th:text="${cariMap.get(siparis.getCariId()).getCariAd()}"></td>
                            <td th:text="${urunMap.get(siparis.getUrunId()).getUrunAd()}"></td>
                            <td th:text="${siparis.getAdet()}"></td>
                            <td th:text="${textUtils.truncZeroFromPrice(siparis.getTutar()) + ' TL'}"></td>
                            <td th:text="${siparis.getSatisIade() eq 1} ? 'SATIŞ' : 'İADE'" th:class="${siparis.getSatisIade() eq 1} ? 'text-success' : 'text-danger'"></td>
                            <td th:text="${dateUtils.toTurkishDateTime(siparis.getTarih())}"></td>
                        </tr>
                    </th:block>
                </table>
            </div>
        </div>
    </div>

    <div class="row" th:if="${!tahsilatList.isEmpty() or !siparisList.isEmpty()}">
        <div class="m-0 p-0">
            <div class="col-md-10 mx-auto mt-3">
                <div class="d-flex m-0 p-0 justify-content-between">
                    <nav aria-label="..." class="m-0 p-0">
                        <ul class="pagination border-koseli-1px" th:if="${!tahsilatList.isEmpty() or !siparisList.isEmpty()}">
                            <li class="page-item">
                                <a class="page-link border-0 txt-deep-purple" id="excelDownload" th:href="@{/rapor/excel/(cariId = ${cariId}, tarih = ${baslangicTarihi}, bitis = ${bitisTarihi}, tip = ${tip})}"><span th:text="${tip} + ' Rapor '"></span> <i class="fa-solid fa-file-excel"></i></a>
                            </li>
                        </ul>
                    </nav>

                    <nav aria-label="..." class="m-0 p-0">
                        <ul class="pagination border-koseli-1px">
                            <li class="page-item" th:disabled="${pageNo==0}">
                                <a class="page-link border-0 txt-deep-purple" th:if="${pageNo==0}">İlk</a>
                                <a class="page-link border-0 txt-deep-purple" th:if="${pageNo>0}" th:href="@{/rapor/show/(page = 0, cariId = ${cariId}, tarih = ${baslangicTarihi}, bitis = ${bitisTarihi})}">İlk</a>
                            </li>
                            <li class="page-item" th:disabled="${pageNo==0}">
                                <a class="page-link border-0 txt-deep-purple" th:if="${pageNo==0}">Önceki</a>
                                <a class="page-link border-0 txt-deep-purple" th:if="${pageNo>0}" th:href="@{/rapor/show/(page = ${pageNo}-1, cariId = ${cariId}, tarih = ${baslangicTarihi}, bitis = ${bitisTarihi})}">Önceki</a>
                            </li>
                            <li class="page-item" th:each="pageIndex : ${totalPages}">
                                <th:block th:if="${(pageIndex.intValue() <= (pageNo + 2)) and (pageIndex.intValue() >= (pageNo - 2)) }">
                                    <a th:class="${pageIndex.intValue() == pageNo} ? 'page-link border-0 but-deep-purple active' : 'page-link border-0 txt-deep-purple'" th:href="@{/rapor/show/(page = ${pageIndex.intValue()}, cariId = ${cariId}, tarih = ${baslangicTarihi}, bitis = ${bitisTarihi})}" th:text="${(pageIndex.intValue() + 1)}"></a>
                                </th:block>
                                <th:block th:if="${!((pageIndex.intValue() <= (pageNo + 2)) and (pageIndex.intValue() >= (pageNo - 2))) and (pageIndex.intValue() == 0 or pageIndex.intValue() == totalPages.size() -1)}">
                                    <a class="page-link border-0 txt-deep-purple" th:text=".."></a>
                                </th:block>
                            </li>
                            <li class="page-item" th:disabled="${pageNo+1 == totalPages.size()}">
                                <a class="page-link border-0 txt-deep-purple" th:if="${(pageNo+1) == totalPages.size()}">Sonraki</a>
                                <a class="page-link border-0 txt-deep-purple" th:if="${(pageNo+1) < totalPages.size()}" th:href="@{/rapor/show/(page = ${pageNo}+1, cariId = ${cariId}, tarih = ${baslangicTarihi}, bitis = ${bitisTarihi})}">Sonraki</a>
                            </li>
                            <li class="page-item" th:disabled="${(pageNo+1) == totalPages.size()}">
                                <a class="page-link border-0 txt-deep-purple" th:if="${(pageNo+1) == totalPages.size()}">Son</a>
                                <a class="page-link border-0 txt-deep-purple" th:if="${(pageNo+1) < totalPages.size()}" th:href="@{/rapor/show/(page = ${totalPages.size()} - 1, cariId = ${cariId}, tarih = ${baslangicTarihi}, bitis = ${bitisTarihi})}">Son</a>
                            </li>
                        </ul>
                    </nav>
                </div>
            </div>
        </div>
    </div>




    <footer class="py-5">

        <div class="d-flex flex-column flex-sm-row justify-content-between py-4 my-4 border-top-1px">
            <p class="foot_baslik">&copy; 2022 Kete Ekmek</p>
            <ul class="list-unstyled d-flex">
                <li class="ms-3"><a class="link-dark" href="#"><svg class="bi" width="24" height="24"><use xlink:href="#twitter"/></svg></a></li>
                <li class="ms-3"><a class="link-dark" href="#"><svg class="bi" width="24" height="24"><use xlink:href="#instagram"/></svg></a></li>
                <li class="ms-3"><a class="link-dark" href="#"><svg class="bi" width="24" height="24"><use xlink:href="#facebook"/></svg></a></li>
            </ul>
        </div>
    </footer>

</div>



<script th:src="@{/js/firin.js}"></script>
<script th:src="@{/js/bootstrap.bundle.min.js}"></script>


<script>
    /*
    let tahsil = document.getElementById("tahsil");
    let tahsilCheck = document.getElementById("tahsilCheck");
    tahsilCheck.addEventListener("click", (e) => {
        if (tahsilCheck.checked) {
            tahsil.value = 1;
        } else {
            tahsil.value = 0;
        }
    });
     */
</script>

</body>
</html>